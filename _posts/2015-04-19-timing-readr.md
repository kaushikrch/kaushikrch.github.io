---
layout: post
title: Benchmarking file imports
category: R, r-project
---

Recently, [Hadley Wickham](http://had.co.nz/) announced the release of [readr](http://cran.r-project.org/web/packages/readr/) package v0.1.0. Having been written using [Rcpp](http://dirk.eddelbuettel.com/code/rcpp.html), this package claims to read tabular data into R in a fast and friendly manner. 

I decided to benchmark `read_csv()` from the readr package for a large csv file with base `read.csv()` function and `fread()` from the [data.table](http://cran.r-project.org/web/packages/data.table/) package, which is written in C. 

I use the `flights` data from [nycflights13](http://cran.r-project.org/web/packages/nycflights13/) package.


```r
library(nycflights13)
write.csv(flights, "flights.csv")
```

The *flights.csv* file gets extracted as a 25.5MB CSV file on my Windows machine. 


```r
library(rbenchmark)
library(data.table); library(readr)

## Read using read.csv() function from base
read.base <- function(x){
  read.csv("flights.csv")
}

## Read using read_csv() function from readr
read.readr <- function(x){
  read_csv("flights.csv")
}

## Read using fread() function from data.table
read.DT <- function(x){
  read_csv("flights.csv")
}

benchmark(
  read.base(),
  read.readr(),
  read.DT(),
  replications = 10
  )
```

```
## |===                                                                            |   4%    1 MB|======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |===                                                                            |   4%    1 MB|======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |===                                                                            |   4%    1 MB|======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
```

```
##           test replications elapsed relative user.self sys.self user.child
## 1  read.base()           10   30.91    2.992     30.51     0.32         NA
## 3    read.DT()           10   13.18    1.276     12.84     0.08         NA
## 2 read.readr()           10   10.33    1.000      9.99     0.13         NA
##   sys.child
## 1        NA
## 3        NA
## 2        NA
```

Both `fread()` and `read_csv()` provides us with significant improvement in timings.

Let's tweak the `read.csv()` function to read the all the columns as characters (which supposedly improves performance).


```r
## Read using read.csv() function from base
read.base2 <- function(x){
  read.csv("flights.csv", colClasses = "character")
}

benchmark(
  read.base(),
  read.base2(),
  read.readr(),
  read.DT(),
  replications = 10
  )
```

```
## |==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |===                                                                            |   4%    1 MB|======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
## |======                                                                         |   8%    2 MB|==========                                                                     |  12%    3 MB|=============                                                                  |  17%    4 MB|=================                                                              |  21%    5 MB|====================                                                           |  26%    6 MB|========================                                                       |  30%    7 MB|===========================                                                    |  34%    8 MB|===============================                                                |  39%   10 MB|==================================                                             |  43%   11 MB|======================================                                         |  47%   12 MB|=========================================                                      |  52%   13 MB|=============================================                                  |  56%   14 MB|================================================                               |  61%   15 MB|====================================================                           |  65%   16 MB|=======================================================                        |  69%   17 MB|===========================================================                    |  74%   18 MB|==============================================================                 |  78%   20 MB|==================================================================             |  82%   21 MB|=====================================================================          |  87%   22 MB|=========================================================================      |  91%   23 MB|============================================================================   |  96%   24 MB|================================================================================| 100%   25 MB
```

```
##           test replications elapsed relative user.self sys.self user.child
## 1  read.base()           10   34.87    3.067     33.94     0.45         NA
## 2 read.base2()           10   30.59    2.690     29.67     0.69         NA
## 4    read.DT()           10   11.37    1.000     11.29     0.05         NA
## 3 read.readr()           10   12.11    1.065     11.84     0.07         NA
##   sys.child
## 1        NA
## 2        NA
## 4        NA
## 3        NA
```

Though the performance of `read.csv()` functions improves, it does not even come closer to that of function from readr or data.table packages.

Thanks, Hadley Wickham, Romain Francois for readr; Matt Dowle et.al. for data.table. Now I can read my data much more quickly and efficiently.
