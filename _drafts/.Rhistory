View(model.dat)
rename(model.dat, PROMO_FLAG = PROMO_FLAG_CANN)
rename(model.dat, PROMO_FLAG = "PROMO_FLAG_CANN")
rename(model.dat, "PROMO_FLAG" = "PROMO_FLAG_CANN")
rename(model.dat, c("PRMO_FLAG" = "PROMO_FLAG_CANN"))
rename(model.dat, c("PRMO_FLAG"), c("PROMO_FLAG_CANN"))
rename <- function(dat, oldnames, newnames) {
datnames <- colnames(dat)
datnames[which(datnames %in% oldnames)] <- newnames
colnames(dat) <- datnames
dat
}
rename(model.dat, c("PRMO_FLAG"), c("PROMO_FLAG_CANN"))
View(model.dat)
model.dat <- model.dat %>%
rename(c("PRMO_FLAG"), c("PROMO_FLAG_CANN"))
View(model.dat)
model.dat <- model.dat %>%
rename(c("PROMO_FLAG"), c("PROMO_FLAG_CANN"))
View(model.dat)
View(model.dat)
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
model.dat <- model.dat %>%
rename(c("PROMO_FLAG"), c("PROMO_FLAG_CANN"))
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
View(file.ppg)
View(model.dat)
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
View(model.dat)
unique(file.ppg)
nrow(unique(file.ppg))
nrow(unique(file.ppg.flt))
View(model.dat)
View(file.ppg.flt)
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
View(file.ppg)
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
View(file.ppg)
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
model.dat <- model.dat %>%
rename(c("PROMO_FLAG"), c("PROMO_FLAG_CANN"))
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
## Calculate drag factor on base volume
est1 <- paste0("est_lg_Vol_", cann.ppg1)
est2 <- paste0("est_lg_Vol_", cann.ppg2)
file.ppg <- eval(substitute(mutate(file.ppg, d1 = cann.ppg1^est1), list(cann.ppg1 = as.name(cann.ppg1), est1 = as.name(est1))))
file.ppg <- eval(substitute(mutate(file.ppg, d2 = cann.ppg2^est2), list(cann.ppg2 = as.name(cann.ppg2), est2 = as.name(est2))))
file.ppg <- file.ppg %>%
mutate(New_Base = ifelse(PROMO_FLAG == 1, Base_Volume*d1*d2, Base_Volume)) %>%
mutate(New_Pred_Ad = New_Base*Cann_Volume*Promo_Volume) %>%
ungroup()
act_pred <- file.ppg %>%
group_by(Date, CLUSTER) %>%
summarise(Act = sum(Volume),
New_Pred = sum(New_Pred_Ad),
Old_Pred = sum(Predicted_from_Mixed),
XXL_Lays = sum(XXL_Lays),
XXL_Tostitos = sum(XXL_Tostitos),
Coef_XXL_Lays = mean(est_lg_Vol_XXL_Lays),
Coef_XXL_Tostitos = mean(est_lg_Vol_XXL_Tostitos),
Base_Vol = sum(Base_Volume),
New_Base_Vol = sum(New_Base))
write.csv(act_pred, "act_pred.csv")
View(model.dat)
head(file.ppg$d1)
Inf
file.ppg$d1 <- ifelse(is.infinite(file.ppg$d1), 1, file.ppg$d1)
file.ppg$d2 <- ifelse(is.infinite(file.ppg$d2), 1, file.ppg$d2)
head(file.ppg$d1)
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
## Calculate drag factor on base volume
est1 <- paste0("est_lg_Vol_", cann.ppg1)
est2 <- paste0("est_lg_Vol_", cann.ppg2)
file.ppg <- eval(substitute(mutate(file.ppg, d1 = cann.ppg1^est1), list(cann.ppg1 = as.name(cann.ppg1), est1 = as.name(est1))))
file.ppg <- eval(substitute(mutate(file.ppg, d2 = cann.ppg2^est2), list(cann.ppg2 = as.name(cann.ppg2), est2 = as.name(est2))))
file.ppg$d1 <- ifelse(is.infinite(file.ppg$d1), 1, file.ppg$d1)
file.ppg$d2 <- ifelse(is.infinite(file.ppg$d2), 1, file.ppg$d2)
file.ppg <- file.ppg %>%
mutate(New_Base = ifelse(PROMO_FLAG == 1, Base_Volume*d1*d2, Base_Volume)) %>%
mutate(New_Pred_Ad = New_Base*Cann_Volume*Promo_Volume) %>%
ungroup()
act_pred <- file.ppg %>%
group_by(Date, CLUSTER) %>%
summarise(Act = sum(Volume),
New_Pred = sum(New_Pred_Ad),
Old_Pred = sum(Predicted_from_Mixed),
XXL_Lays = sum(XXL_Lays),
XXL_Tostitos = sum(XXL_Tostitos),
Coef_XXL_Lays = mean(est_lg_Vol_XXL_Lays),
Coef_XXL_Tostitos = mean(est_lg_Vol_XXL_Tostitos),
Base_Vol = sum(Base_Volume),
New_Base_Vol = sum(New_Base))
write.csv(act_pred, "act_pred.csv")
store_level <- file.ppg %>%
select(Volume, Base_Volume, Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base)
write.csv(store_level, "store_level.csv")
store_level <- file.ppg %>%
select(Date, RE_STO_NUM, PROMO_FLAG, CLUSTER, Volume, Base_Volume,
Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base)
write.csv(store_level, "store_level.csv")
install.packages("readr")
library(knitr)
args = commandArgs(TRUE)
filename = args[1]
# Check that it's a .Rmd file.
if(!grepl(".Rmd", filename)) {
stop("You must specify a .Rmd file.")
}
Sys.which("Rscript")
library(knitr)
args = timing-readr.Rmd
args = "timing-readr.Rmd"
filename = args[1]
filename
if(!grepl(".Rmd", filename)) {
stop("You must specify a .Rmd file.")
}
dir = paste0("../_posts/", Sys.Date(), "-")
output = paste0(dir, sub('.Rmd', '.md', filename))
knit(filename, output)
# Copy .png files to the images directory.
fromdir = "{{ site.url }}/images"
todir = "../images"
pics = list.files(fromdir, ".png")
pics = sapply(pics, function(x) paste(fromdir, x, sep="/"))
file.copy(pics, todir)
unlink("{{ site.url }}", recursive=T)
setwd("~/kaushikrch.github.io/_drafts/")
args = "timing-readr.Rmd"
filename = args[1]
# Check that it's a .Rmd file.
if(!grepl(".Rmd", filename)) {
stop("You must specify a .Rmd file.")
}
# Knit and place in _posts.
dir = paste0("../_posts/", Sys.Date(), "-")
output = paste0(dir, sub('.Rmd', '.md', filename))
knit(filename, output)
dir = paste0("../_posts/", Sys.Date(), "-")
output = paste0(dir, sub('.Rmd', '.md', filename))
knit(filename, output)
# Copy .png files to the images directory.
fromdir = "{{ site.url }}/images"
todir = "../images"
pics = list.files(fromdir, ".png")
pics = sapply(pics, function(x) paste(fromdir, x, sep="/"))
file.copy(pics, todir)
unlink("{{ site.url }}", recursive=T)
Sys.which("Rscript")
?Rscript
install.packages("knitr")
install.packages("knitr")
library(dplyr)
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM +PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
store_level <- file.ppg %>%
select(Date, RE_STO_NUM, PROMO_FLAG, CLUSTER, Volume, Base_Volume,
Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base, New_Pred_Ad)
write.csv(store_level, "store_level.csv")
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
write.csv(model.dat1, "mod-dat.csv")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
## Calculate drag factor on base volume
est1 <- paste0("est_lg_Vol_", cann.ppg1)
est2 <- paste0("est_lg_Vol_", cann.ppg2)
file.ppg <- eval(substitute(mutate(file.ppg, d1 = cann.ppg1^est1), list(cann.ppg1 = as.name(cann.ppg1), est1 = as.name(est1))))
file.ppg <- eval(substitute(mutate(file.ppg, d2 = cann.ppg2^est2), list(cann.ppg2 = as.name(cann.ppg2), est2 = as.name(est2))))
file.ppg$d1 <- ifelse(is.infinite(file.ppg$d1), 1, file.ppg$d1)
file.ppg$d2 <- ifelse(is.infinite(file.ppg$d2), 1, file.ppg$d2)
file.ppg <- file.ppg %>%
mutate(New_Base = ifelse(PROMO_FLAG == 1, Base_Volume*d1*d2, Base_Volume)) %>%
mutate(New_Pred_Ad = New_Base*Cann_Volume*Promo_Volume) %>%
ungroup()
act_pred <- file.ppg %>%
group_by(Date, CLUSTER) %>%
summarise(Act = sum(Volume),
New_Pred = sum(New_Pred_Ad),
Old_Pred = sum(Predicted_from_Mixed),
XXL_Lays = sum(XXL_Lays),
XXL_Tostitos = sum(XXL_Tostitos),
Coef_XXL_Lays = mean(est_lg_Vol_XXL_Lays),
Coef_XXL_Tostitos = mean(est_lg_Vol_XXL_Tostitos),
Base_Vol = sum(Base_Volume),
New_Base_Vol = sum(New_Base))
store_level <- file.ppg %>%
select(Date, RE_STO_NUM, PROMO_FLAG, CLUSTER, Volume, Base_Volume,
Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base, New_Pred_Ad)
write.csv(store_level, "store_level.csv")
write.csv(act_pred, "act_pred.csv")
library(reshape2)
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
write.csv(model.dat1, "mod-dat.csv")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
## Calculate drag factor on base volume
est1 <- paste0("est_lg_Vol_", cann.ppg1)
est2 <- paste0("est_lg_Vol_", cann.ppg2)
file.ppg <- eval(substitute(mutate(file.ppg, d1 = cann.ppg1^est1), list(cann.ppg1 = as.name(cann.ppg1), est1 = as.name(est1))))
file.ppg <- eval(substitute(mutate(file.ppg, d2 = cann.ppg2^est2), list(cann.ppg2 = as.name(cann.ppg2), est2 = as.name(est2))))
file.ppg$d1 <- ifelse(is.infinite(file.ppg$d1), 1, file.ppg$d1)
file.ppg$d2 <- ifelse(is.infinite(file.ppg$d2), 1, file.ppg$d2)
file.ppg <- file.ppg %>%
mutate(New_Base = ifelse(PROMO_FLAG == 1, Base_Volume*d1*d2, Base_Volume)) %>%
mutate(New_Pred_Ad = New_Base*Cann_Volume*Promo_Volume) %>%
ungroup()
act_pred <- file.ppg %>%
group_by(Date, CLUSTER) %>%
summarise(Act = sum(Volume),
New_Pred = sum(New_Pred_Ad),
Old_Pred = sum(Predicted_from_Mixed),
XXL_Lays = sum(XXL_Lays),
XXL_Tostitos = sum(XXL_Tostitos),
Coef_XXL_Lays = mean(est_lg_Vol_XXL_Lays),
Coef_XXL_Tostitos = mean(est_lg_Vol_XXL_Tostitos),
Base_Vol = sum(Base_Volume),
New_Base_Vol = sum(New_Base))
store_level <- file.ppg %>%
select(Date, RE_STO_NUM, PROMO_FLAG, CLUSTER, Volume, Base_Volume,
Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base, New_Pred_Ad)
write.csv(store_level, "store_level.csv")
write.csv(act_pred, "act_pred.csv")
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
write.csv(model.dat1, "mod-dat.csv")
## Join volume of cannibalizing PPGs from model data to mixed file
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
## Calculate drag factor on base volume
est1 <- paste0("est_lg_Vol_", cann.ppg1)
est2 <- paste0("est_lg_Vol_", cann.ppg2)
file.ppg <- eval(substitute(mutate(file.ppg, d1 = cann.ppg1^est1), list(cann.ppg1 = as.name(cann.ppg1), est1 = as.name(est1))))
file.ppg <- eval(substitute(mutate(file.ppg, d2 = cann.ppg2^est2), list(cann.ppg2 = as.name(cann.ppg2), est2 = as.name(est2))))
file.ppg$d1 <- ifelse(is.infinite(file.ppg$d1), 1, file.ppg$d1)
file.ppg$d2 <- ifelse(is.infinite(file.ppg$d2), 1, file.ppg$d2)
file.ppg <- file.ppg %>%
mutate(New_Base = ifelse(PROMO_FLAG == 1, Base_Volume*d1*d2, Base_Volume)) %>%
mutate(New_Pred_Ad = New_Base*Cann_Volume*Promo_Volume) %>%
ungroup()
act_pred <- file.ppg %>%
group_by(Date, CLUSTER) %>%
summarise(Act = sum(Volume),
New_Pred = sum(New_Pred_Ad),
Old_Pred = sum(Predicted_from_Mixed),
XXL_Lays = sum(XXL_Lays),
XXL_Tostitos = sum(XXL_Tostitos),
Coef_XXL_Lays = mean(est_lg_Vol_XXL_Lays),
Coef_XXL_Tostitos = mean(est_lg_Vol_XXL_Tostitos),
Base_Vol = sum(Base_Volume),
New_Base_Vol = sum(New_Base))
store_level <- file.ppg %>%
select(Date, RE_STO_NUM, PROMO_FLAG, CLUSTER, Volume, Base_Volume,
Predicted_from_Mixed, XXL_Lays, XXL_Tostitos,
est_lg_Vol_XXL_Lays, est_lg_Vol_XXL_Tostitos, New_Base, New_Pred_Ad)
write.csv(store_level, "store_level.csv")
write.csv(act_pred, "act_pred.csv")
setwd("C:/Users/k.roy.chowdhury/Documents/Job_Files/Frito_Lays_v2/New_Calc")
## Enter file names
file.name <- "mix_join_total_effect_l_pslay"
mod.dat   <- "fin_mod_dat_5"
## Enter names of cannibalizing PPGs
cann.ppg1 <- "XXL_Lays"
cann.ppg2 <- "XXL_Tostitos"
## Import sas files
library(haven)
file.ppg  <- read_sas(paste0("Done/", file.name, ".sas7bdat"))
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG , value.var = "Vol_Promo")
model.dat <- dcast(model.dat, Date + RE_STO_NUM ~ PPG , value.var = "Vol_Promo")
write.csv(model.dat1, "mod-dat.csv")
file.ppg <- left_join(file.ppg, model.dat, by = c("Date", "RE_STO_NUM"))
View(model.dat1)
model.dat <- read_sas(paste0("Done/", mod.dat, ".sas7bdat"))
## Filter the model data file to keep volume of relevant PPGs by date
library(dplyr)
model.dat <- model.dat %>%
group_by(PPG, RE_STO_NUM, Date) %>%
filter(PPG %in% c(cann.ppg1, cann.ppg2)) %>%
mutate(Vol_Promo = ifelse(PROMO_FLAG == 1, Volume, 0))
## Transpose model data file
library(reshape2)
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM + PROMO_FLAG ~ PPG + PROMO_FLAG)
View(model.dat1)
View(model.dat1)
head(model.dat1)
model.dat1 <- dcast(model.dat, Date + RE_STO_NUM ~ PPG + PROMO_FLAG, value.var = "PROMO_FLAG")
View(model.dat1)
head(model.dat1)
write.csv(model.dat1, "mod-dat.csv")
library(knitr)
setwd("~/kaushikrch.github.io/_drafts/")
# Get the filename given as an argument in the shell.
args = "timing-readr.Rmd"
filename = args[1]
# Check that it's a .Rmd file.
if(!grepl(".Rmd", filename)) {
stop("You must specify a .Rmd file.")
}
# Knit and place in _posts.
dir = paste0("../_posts/", Sys.Date(), "-")
output = paste0(dir, sub('.Rmd', '.md', filename))
knit(filename, output)
# Copy .png files to the images directory.
fromdir = "{{ site.url }}/images"
todir = "../images"
pics = list.files(fromdir, ".png")
pics = sapply(pics, function(x) paste(fromdir, x, sep="/"))
file.copy(pics, todir)
unlink("{{ site.url }}", recursive=T)
